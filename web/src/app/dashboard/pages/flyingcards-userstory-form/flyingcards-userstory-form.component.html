<app-project-header
  (onBack)="navigateToKanban()"
  voltar="Voltar ao Flying Cards"
></app-project-header>

<div class="container px-5 pt-16 pb-4 mx-auto">
  <form
    [formGroup]="userStoryFormGroup"
    class="border-l-4 border-violet-700 rounded-lg md:w-1/2 mx-auto flex flex-col items-center shadow-lg p-10"
  >
    <div class="rounded-full bg-violet-700 p-2">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="currentColor"
        class="ws-10 h-10 text-white font-black"
      >
        <path
          fillRule="evenodd"
          d="M14.447 3.027a.75.75 0 01.527.92l-4.5 16.5a.75.75 0 01-1.448-.394l4.5-16.5a.75.75 0 01.921-.526zM16.72 6.22a.75.75 0 011.06 0l5.25 5.25a.75.75 0 010 1.06l-5.25 5.25a.75.75 0 11-1.06-1.06L21.44 12l-4.72-4.72a.75.75 0 010-1.06zm-9.44 0a.75.75 0 010 1.06L2.56 12l4.72 4.72a.75.75 0 11-1.06 1.06L.97 12.53a.75.75 0 010-1.06l5.25-5.25a.75.75 0 011.06 0z"
          clipRule="evenodd"
        />
      </svg>
    </div>
    <h2 class="my-4 text-xl text-center">
      @if (isEdit) { Editar } @else { Inserir }
      <span class="font-medium text-violet-700">User Story</span>
    </h2>
    <div class="mb-4 flex flex-wrap" style="gap: 1rem 0">
      <div class="relative w-full">
        <label for="titulo" class="leading-7 text-sm text-gray-600"
          >Título</label
        >
        <input
          type="text"
          id="titulo"
          name="titulo"
          formControlName="titulo"
          class="w-full bg-gray-100 bg-opacity-50 rounded border border-gray-300 focus:border-violet-700 focus:bg-white focus:ring-2 focus:ring-violet-700 text-base outline-none text-gray-700 py-1 px-3 leading-8 transition-colors duration-200 ease-in-out"
        />
        @if (userStoryFormGroup.get('titulo').invalid &&
        userStoryFormGroup.get('titulo').touched) {
        <p class="text-red-500 text-xs italic">
          {{
            userStoryFormGroup.get("titulo").errors.required
              ? "Campo obrigatório"
              : ""
          }}
        </p>
        }
      </div>

      <div class="relative w-full">
        <label for="descricao" class="leading-7 text-sm text-gray-600"
          >Descrição</label
        >
        <textarea
          type="text"
          id="descricao"
          name="descricao"
          formControlName="descricao"
          class="w-full h-20 bg-gray-100 bg-opacity-50 rounded border border-gray-300 focus:border-violet-700 focus:bg-white focus:ring-2 focus:ring-violet-700 text-base outline-none text-gray-700 py-1 px-3 leading-8 transition-colors duration-200 ease-in-out"
        ></textarea>
      </div>

      <div class="relative w-2/4 mr-1">
        <label for="responsavel" class="leading-7 text-sm text-gray-600"
          >Responsável</label
        >
        <select
          id="responsavel"
          name="responsavel"
          formControlName="responsavel"
          class="w-full bg-gray-100 bg-opacity-50 rounded border border-gray-300 focus:border-violet-700 focus:bg-white focus:ring-2 focus:ring-violet-700 text-base outline-none text-gray-700 py-1 px-3 leading-8 transition-colors duration-200 ease-in-out"
        >
          <option *ngFor="let usuario of usuarios" value="{{ usuario.id }}">
            {{ usuario.nome }}
          </option>
        </select>
        @if (userStoryFormGroup.get('responsavel').invalid &&
        userStoryFormGroup.get('responsavel').touched) {
        <p class="text-red-500 text-xs italic">
          {{
            userStoryFormGroup.get("responsavel").errors.required
              ? "Campo obrigatório"
              : ""
          }}
        </p>
        }
      </div>

      <div class="relative w-1/4 mx-1">
        <label for="estimativa_tempo" class="leading-7 text-sm text-gray-600"
          >Estimativa de tempo</label
        >
        <input
          type="text"
          id="estimativa_tempo"
          name="estimativa_tempo"
          formControlName="estimativa_tempo"
          class="w-full bg-gray-100 bg-opacity-50 rounded border border-gray-300 focus:border-violet-700 focus:bg-white focus:ring-2 focus:ring-violet-700 text-base outline-none text-gray-700 py-1 px-3 leading-5 transition-colors duration-200 ease-in-out"
        />
        @if (userStoryFormGroup.get('estimativa_tempo').invalid &&
        userStoryFormGroup.get('estimativa_tempo').touched) {
        <p class="text-red-500 text-xs italic">
          {{
            userStoryFormGroup.get("estimativa_tempo").errors.required
              ? "Campo obrigatório"
              : ""
          }}
        </p>
        }
      </div>

      <div class="relative w-2/4 mr-1">
        <label for="swimlane" class="leading-7 text-sm text-gray-600"
          >Swimlane</label
        >
        <select
          name="swimlane"
          id="swimlane"
          formControlName="swimlane"
          class="w-full bg-gray-100 bg-opacity-50 rounded border border-gray-300 focus:border-violet-700 focus:bg-white focus:ring-2 focus:ring-violet-700 text-base outline-none text-gray-700 py-1 px-3 leading-8 transition-colors duration-200 ease-in-out"
        >
          <option *ngFor="let swimlane of swimlanes" value="{{ swimlane.id }}">
            {{ swimlane.nome }}
          </option>
        </select>
      </div>

      <div class="relative w-1/4 mr-1">
        <label class="leading-7 text-sm text-gray-600">Tag</label>
        <select
          class="w-full bg-gray-100 bg-opacity-50 rounded border border-gray-300 focus:border-violet-700 focus:bg-white focus:ring-2 focus:ring-violet-700 text-base outline-none text-gray-700 py-1 px-3 leading-8 transition-colors duration-200 ease-in-out"
          name="tags"
          id="tags"
          formControlName="tag"
        >
          @for (tag of tagsList; track tag) {
          <option [value]="tag.id">
            {{ tag.nome }}
          </option>
          }
        </select>
      </div>
    </div>
    <div class="flex w-full justify-between">
      @if (isEdit) {
      <app-button color="danger" (onClick)="deletarUserStory()">
        Deletar </app-button
      >}

      <div class="flex w-full justify-end gap-2">
        <app-button
          (onClick)="navigateToKanban()"
          class="mb-4"
          color="secondary"
        >
          Cancelar
        </app-button>

        <app-button (onClick)="handleUserStory()">
          <app-plus-icon></app-plus-icon>
          @if(isEdit) { Editar } @else { Adicionar } User Story
        </app-button>
      </div>
    </div>
  </form>
</div>

@if (isEdit) {
<div class="flex flex-col justify-center items-center py-4 w-full gap-4">
  <!-- Caixinha do comentário -->
  <div
    *ngFor="let comentario of comentarios"
    class="border-violet-700 border-2 rounded-md p-2 max-w-xl w-full bg-white"
  >
    <div class="flex justify-between items-center pb-2">
      <div class="flex gap-2">
        <!-- Nome do autor do comentário  -->
        <span class="text-xs font-bold">{{ comentario.nome_usuario }}</span>

        <!--  Tempo decorrido da postagem -->
        <span class="text-xs text-gray-600">1d</span>
      </div>
      <div class="scale-75 cursor-pointer">
        <app-three-dots-icon></app-three-dots-icon>
      </div>
    </div>

    <!-- Conteúdo do comentário -->
    <span>{{ comentario.comentario }}</span>
  </div>

  <!-- Caixinha de novo comentário -->
  <div
    class="flex border-gray-500 border-2 rounded-md p-2 max-w-xl w-full bg-white hover:border-violet-700 transition-colors"
  >
    <input
      class="focus:outline-none w-full"
      type="text"
      placeholder="Escreva um comentário..."
      name="conteudo_comentario"
      id="conteudo_comentario"
      [(ngModel)]="newComentario"
      (keyup.enter)="enviarComentario()"
    />

    <app-button (onClick)="enviarComentario()">
      <app-send-icon class="cursor-pointer"></app-send-icon>
    </app-button>
  </div>
</div>
}
