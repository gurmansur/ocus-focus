<div class="px-8 py-5">
  <div class="flex justify-between items-center">
    <h2 class="text-3xl font-medium mb-5">Árvores de Testes</h2>
    <div class="flex gap-4">
      <button
        (click)="executarTodosProjeto()"
        [disabled]="executando"
        class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors font-medium flex items-center gap-2"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="w-5 h-5"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.971l-11.54 6.347a1.125 1.125 0 01-1.667-.985V5.653z"
          />
        </svg>
        {{ executando ? "Executando..." : "Executar Todos" }}
      </button>
      <app-button (click)="openCoverageModal()">
        Cobertura de Testes
      </app-button>
    </div>
  </div>

  <div class="max-w rounded overflow-hidden shadow-lg p-4 bg-white" #fileTree>
    <p-tree
      [value]="fileTreeNodes"
      emptyMessage="Nenhum caso ou suíte de teste encontrados"
      [selectionMode]="'single'"
      [draggableNodes]="true"
      [droppableNodes]="true"
      [validateDrop]="true"
      (onNodeDrop)="onNodeDrop($event)"
      [contextMenu]="contextMenu"
      (onNodeContextMenuSelect)="onContextMenuSelect($event)"
    >
    </p-tree>
    <p-contextMenu
      #contextMenu
      [target]="fileTree"
      [model]="contextMenuItems"
      [style]="{ 'white-space': 'nowrap', width: 'auto' }"
    ></p-contextMenu>
    <p-sidebar
      [(visible)]="displaySidebar"
      [position]="'right'"
      [style]="{ width: '70%' }"
      [showCloseIcon]="true"
      [baseZIndex]="10000"
      (onShow)="onShowDetails($event)"
      (onHide)="onHideDetails($event)"
    >
      <h3 class="text-2xl font-medium mb-5">
        Detalhes
        @if (selectedNode?.type === "case") {
          de Caso de Teste
        } @else {
          de Suíte de Teste
        }
      </h3>
      @if (selectedNode?.type === "case") {
        <div class="grid grid-cols-2 gap-4">
          <div class="flex flex-col gap-2">
            <span class="font-medium">Nome</span>
            <span>{{ selectedNode?.data.nome }}</span>
          </div>
          <hr class="col-span-2" />
          <div class="flex flex-col gap-2">
            <span class="font-medium">Descrição</span>
            <span>{{ selectedNode?.data.descricao }}</span>
          </div>
          <hr class="col-span-2" />
          <div class="flex flex-col gap-2">
            <span class="font-medium">Testador Designado</span>
            <span>{{ selectedNode?.data.testadorDesignado?.nome || "-" }}</span>
          </div>
          <hr class="col-span-2" />
          <div class="flex flex-col gap-2">
            <span class="font-medium">Caso de Uso Relacionado</span>
            <span>{{ selectedNode?.data.casoDeUso?.nome || "-" }}</span>
          </div>
          <hr class="col-span-2" />
          <div class="flex flex-col gap-2">
            <span class="font-medium">Observações</span>
            <span>{{ selectedNode?.data.observacoes }}</span>
          </div>
          <hr class="col-span-2" />
          <div class="flex flex-col gap-2">
            <span class="font-medium">Prioridade</span>
            <span>{{ selectedNode?.data.prioridade }}</span>
          </div>
          <hr class="col-span-2" />
          <div class="flex flex-col gap-2">
            <span class="font-medium">Pré-condições</span>
            <span>{{ selectedNode?.data.preCondicao }}</span>
          </div>
          <hr class="col-span-2" />
          <div class="flex flex-col gap-2">
            <span class="font-medium">Pós-condições</span>
            <span>{{ selectedNode?.data.posCondicao }}</span>
          </div>
          <hr class="col-span-2" />
          <div class="flex flex-col gap-2">
            <span class="font-medium">Complexidade</span>
            <span>{{ selectedNode?.data.complexidade }}</span>
          </div>
          <hr class="col-span-2" />
          <div class="flex flex-col gap-2">
            <span class="font-medium">Status</span>
            <span>{{ selectedNode?.data.status }}</span>
          </div>
          <hr class="col-span-2" />
          <div class="flex flex-col gap-2">
            <span class="font-medium">Resultado Esperado</span>
            <span>{{ selectedNode?.data.resultadoEsperado }}</span>
          </div>
          <hr class="col-span-2" />
          <div class="flex flex-col gap-2">
            <span class="font-medium">Método</span>
            <span>{{ selectedNode?.data.metodo }}</span>
          </div>
          <hr class="col-span-2" />
          <div class="flex flex-col gap-2">
            <span class="font-medium">Técnica</span>
            <span>{{ selectedNode?.data.tecnica }}</span>
          </div>
          <hr class="col-span-2" />
          <div class="flex flex-col gap-2">
            <span class="font-medium">Dados de Entrada</span>
            <span>{{ selectedNode?.data.dadosEntrada }}</span>
          </div>
        </div>
      } @else {
        <div class="grid grid-cols-2 gap-4">
          <div class="flex flex-col gap-2">
            <span class="font-medium">Nome</span>
            <span>{{ selectedNode?.data.nome }}</span>
          </div>
          <hr class="col-span-2" />
          <div class="flex flex-col gap-2">
            <span class="font-medium">Status</span>
            <span>{{ selectedNode?.data.status }}</span>
          </div>
          <hr class="col-span-2" />
          <div class="flex flex-col gap-2">
            <span class="font-medium">Descrição</span>
            <span>{{ selectedNode?.data.descricao }}</span>
          </div>
          <hr class="col-span-2" />
          <div class="flex flex-col gap-2">
            <span class="font-medium">Observações</span>
            <span>{{ selectedNode?.data.observacoes }}</span>
          </div>
          <hr class="col-span-2" />
          <div class="flex flex-col gap-2" style="padding-bottom: 64px">
            <span class="font-medium">Cobertura de Testes</span>
            <app-pie-chart
              [failed]="failed"
              [passed]="passed"
              [pending]="pending"
            ></app-pie-chart>
          </div>
        </div>
      }
    </p-sidebar>
  </div>

  <app-modal
    (close)="closeDeleteModal()"
    [open]="openDelete"
    [title]="deleteTitle"
    (confirm)="deleteSelected()"
    [message]="deleteMessage"
  >
  </app-modal>

  <app-content-modal
    (close)="closeCoverageModal()"
    [open]="openCoverage"
    [title]="'Cobertura de Testes'"
    (confirm)="closeCoverageModal()"
    confirmText="Fechar"
  >
    <app-pie-chart
      [failed]="failed"
      [passed]="passed"
      [pending]="pending"
    ></app-pie-chart>
  </app-content-modal>

  <!-- Test Execution Modal -->
  <app-test-execution-modal
    [showModal]="showModal"
    [executando]="executando"
    [log]="log"
    (close)="closeExecuteModal()"
  ></app-test-execution-modal>
</div>

<script src="./node_modules/preline/dist/preline.js"></script>
